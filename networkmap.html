<html>

<head>
	<title>networkmap</title>

	<!-- Adapting the view for mobile devices --> 
	<meta name="viewport" content="target-densitydpi=device-dpi, width=device-width" />

	<script type="text/javascript" src="./js/network-min.js"></script>
	<script type="text/javascript" src="./js/jquery-1.11.2.min.js"></script>

	<script type="text/javascript">
		var uniqueID = 0;
		
		var jsonFile = "devices.json"
		var devices = null;
		
		$.getJSON(jsonFile, function(json) {
			devices = json;
		});
		
		var nodesTable = null;
		var linksTable = null;
		var network = null;
		
		// Draws the network map from the devices
		function draw() {
			
			nodesTable = [];
			linksTable = [];
			
			// Temporary alert
			if (devices == null) {
				alert("Could not find '" + jsonFile + "'.")
			}
			
			buildGraph(devices, nodesTable, linksTable, undefined, undefined)
			
			network = new links.Network(document.getElementById('networkmap'));
			
			links.events.addListener(network, 'select', onselect);
			
			var options = {
				width:  '100%',
				height: '100%',
				stabilize: true,
				selectable: true
			};
			
			network.draw(nodesTable, linksTable, options);
		}
		
		// Iterates through the devices to add the nodes and the links
		function buildGraph(device, nodesTable, linksTable, ID, parentID) {
			ID = getNewID();
			
			nodesTable.push(
				{
					'id': ID, 
					'text': device.system_name + "\n" + device.ip_address, 
					'style': 'rect', 
					'group': 1
				});
				
			if (parentID > 0) {
				linksTable.push(
				{
					'from': ID, 
					'to': parentID, 
					'style': 'line', 
					'color': undefined, 
					'width': 2, 
					'length': 222, 
					'title': '12'
				});
			}
			
			for (var i = 0; i < device.children.length; i++) {
				buildGraph(device.children[i], nodesTable, linksTable, ID+i+1, ID);
			}
		}
		
		// Generates a unique ID for the nodes
		function getNewID() {
			return uniqueID+=1;
		}
		
		// Handles the selection of the nodes
		function onselect() {
			var selection = network.getSelection();
			
			var info = 'selected row(s): '  
			for (var i = 0; i < selection.length; i++) {
				info += selection[i].row + ' ';
			}
			
			console.log('Selection: ' + JSON.stringify(selection));
		}
		
	</script>
	
</head>

<body onload="draw();" onresize="network.redraw();">
	<div id="networkmap"></div>
</body>

</html>
