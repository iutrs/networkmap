<html>

<head>
	<title>networkmap</title>

	<script type="text/javascript" src="http://www.google.com/jsapi"></script>
	<script type="text/javascript" src="./js/network-min.js"></script>
	<script type="text/javascript" src="./js/jquery-1.11.2.min.js"></script>

	<script type="text/javascript">
		var uniqueID = 0;
		
		var jsonFile = "devices.json"
		var devices = null;
		
		$.getJSON(jsonFile, function(json) {
			devices = json;
		});
		
		var nodesTable = null;
		var linksTable = null;
		var network = null;
		
		google.load('visualization', '1');
		
		// Set callback to run when API is loaded
		google.setOnLoadCallback(drawVisualization);
		
		// Called when the Visualization API is loaded.
		function drawVisualization() {
			
			// Nodes
			nodesTable = new google.visualization.DataTable();
			nodesTable.addColumn('number', 'id');
			nodesTable.addColumn('string', 'text');
			nodesTable.addColumn('string', 'style');
			nodesTable.addColumn('number', 'group');
			
			// Links
			linksTable = new google.visualization.DataTable();
			linksTable.addColumn('number', 'from');
			linksTable.addColumn('number', 'to');
			linksTable.addColumn('string', 'style');
			linksTable.addColumn('string', 'color');
			linksTable.addColumn('number', 'width');
			linksTable.addColumn('number', 'length');
			linksTable.addColumn('string', 'title');
			
			// Temporary alert
			if (devices == null) {
				alert("Could not find '" + jsonFile + "'.")
			}
			
			// Iterate through the devices to add the nodes and the links
			buildGraph(devices, nodesTable, linksTable, undefined, undefined)
			
			// specify options
			var options = {
				width:  '600px',
				height: '600px',
				stabilize: true,
				selectable: true
			};
			
			// Instantiate our graph object.
			network = new links.Network(document.getElementById('networkmap'));
			
			//Draw our graph with the created data and options
			network.draw(nodesTable, linksTable, options);
		}
		
		function getNewID() {
			return uniqueID += 1
		}
		
		function buildGraph(device, nodesTable, linksTable, ID, parentID) {
			ID = getNewID();
			
			nodesTable.addRow(
				[
					ID, 
					device.system_name + "\n" + device.ip_address, 
					'rect', 
					1
				]);
			
			if (parentID > 0) {
				linksTable.addRow(
				[
					ID, 
					parentID, 
					'line', 
					undefined, 
					2, 
					222, 
					'12'
				]);
			}
			
			for (var i = 0; i < device.children.length; i++) {
				buildGraph(device.children[i], nodesTable, linksTable, ID+i+1, ID);
			}
		}
	</script>
	
</head>

<body>
	<div id="networkmap"></div>
</body>

</html>
